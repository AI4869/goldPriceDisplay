<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>老凤祥珠宝 金价展示</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-red: #a40000;
            --gold: #ffd700;
            --white: #ffffff;
            --dark-red: #8a0000;
        }
      
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
      
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
            color: var(--white);
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
      
        /* 主容器 - 针对9:16比例优化 */
        .container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 56.25vh;  /* 高度作为基准，9/16=0.5625 */
            height: 100vh;
            max-width: 100vw;
            transform: translate(-50%, -50%);
            background: inherit;
            transition: transform 0.6s ease;
            transform-origin: center center;
        }
      
        /* 旋转后的样式 */
        .container.rotated-90 {
            transform: translate(-50%, -50%) rotate(90deg) scale(1.7778);
        }

        .container.rotated-180 {
            transform: translate(-50%, -50%) rotate(180deg);
            
        }
      
        .container.rotated-270 {
            transform: translate(-50%, -50%) rotate(270deg) scale(1.7778);
        }
      
        /* 顶部标题区域 */
        .header {
            padding: 2vh 0;
            text-align: center;
            background: rgba(0, 0, 0, 0.1);
            margin: 0 2vh;
            border-radius: 0 0 2vh 2vh;
            flex: 0 0 14vh;
        }
      
        .header h1 {
            font-size: 9vh;
            margin: 0;
            text-shadow: 0.2vh 0.2vh 0.5vh rgba(0,0,0,0.3);
            color: var(--gold);
            font-weight: 900;
        }
      
        .date {
            font-size: 3.2vh;
            margin-top: 0.8vh;
            font-weight: 700;
        }
      
        /* 今日金价显示区域 - 显著放大 */
        .gold-price-today {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1.5vh 2vh;
            background: rgba(255, 215, 0, 0.15);
            padding: 2vh;
            border-radius: 1.5vh;
            flex: 0 0 18vh;
            border: 0.4vh solid rgba(255, 215, 0, 0.3);
        }
      
        .gold-price-label {
            font-size: 4.5vh;
            font-weight: 900;
            margin-right: 3vh;
            color: var(--gold);
            text-shadow: 0.2vh 0.2vh 0.6vh rgba(0,0,0,0.4);
        }
      
        .gold-price-value {
            font-size: 9vh;
            font-weight: 900;
            text-shadow: 0.3vh 0.3vh 0.8vh rgba(0,0,0,0.5);
            color: #fff9c4;
            letter-spacing: 0.1vw;
        }
      
        /* 价格表格区域 - 放大字体和粗细 */
        .price-table-container {
            background-color: var(--white);
            color: var(--primary-red);
            width: 94%;
            margin: 0 auto;
            border-radius: 2.5vh;
            padding: 2vh 0;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 0.5vh 2vh rgba(0,0,0,0.4);
            border: 0.4vh solid var(--gold);
            max-height: 45vh;
        }
      
        .price-table {
            width: 96%;
            margin: 0 auto;
            border-collapse: collapse;
            font-size: 3.2vh;
            font-weight: 700;
        }
      
        .price-table th, .price-table td {
            padding: 1.6vh 0;
            text-align: center;
        }
      
        .price-table th {
            border-bottom: 0.6vh solid var(--primary-red);
            font-size: 3.5vh;
            padding-bottom: 1.5vh;
            color: var(--primary-red);
            font-weight: 900;
        }
      
        .price-table td {
            color: #222;
            font-weight: 700;
        }
      
        .price-table tr:nth-child(even) {
            background-color: #fff4f4;
        }
      
        .price-table tr:nth-child(odd) {
            background-color: var(--white);
        }
      
        .price-unit {
            font-size: 2.2vh;
            color: #999;
        }
      
        .hide-price {
            color: #ccc;
            font-style: italic;
        }
      
        /* 底部区域 */
        .footer {
            font-size: 4vh;
            color: var(--gold);
            padding: 1.8vh 0;
            font-weight: 900;
            text-shadow: 0.3vh 0.3vh 0.6vh rgba(0,0,0,0.4);
            background: rgba(0, 0, 0, 0.1);
            margin: 0 2vh;
            border-radius: 2vh 2vh 0 0;
            flex: 0 0 12vh;
            text-align: center;
        }
      
        .update-time {
            font-size: 2.5vh;
            color: #ffdfba;
            text-align: center;
            padding: 1vh 0;
            flex: 0 0 5vh;
            font-weight: 600;
        }
      
        /* 控制按钮 */
        .controls {
            position: absolute;
            top: 1.5vh;
            right: 3vh;
            display: flex;
            gap: 1vh;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }
      
        body.show-controls .controls {
            opacity: 1;
        }
      
        .control-btn {
            background-color: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 1.2vh 2vh;
            border-radius: 0.8vh;
            cursor: pointer;
            font-size: 2vh;
            font-weight: 600;
            transition: background 0.3s;
            border: 0.2vh solid rgba(255,255,255,0.2);
        }
      
        .control-btn:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }
      
        /* 管理面板 */
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--white);
            color: #000;
            border-radius: 2.5vh;
            padding: 3.5vh;
            box-shadow: 0 0 4.5vh rgba(0,0,0,0.6);
            width: 85vw;
            max-width: 550px;
            z-index: 1000;
        }
      
        .admin-panel h3 {
            font-size: 3vh;
            margin-bottom: 2.5vh;
            color: var(--primary-red);
            text-align: center;
            font-weight: 900;
        }
      
        .admin-panel label {
            display: block;
            font-size: 2.5vh;
            margin-top: 2vh;
            color: #333;
            font-weight: 700;
        }
      
        .admin-panel input {
            width: 100%;
            font-size: 2.5vh;
            padding: 1.5vh;
            margin-top: 0.8vh;
            border: 0.3vh solid var(--primary-red);
            border-radius: 1vh;
            font-weight: 600;
        }
      
        .admin-panel button {
            margin-top: 3vh;
            font-size: 2.5vh;
            padding: 1.8vh;
            background-color: var(--primary-red);
            color: var(--white);
            border: none;
            border-radius: 1.2vh;
            cursor: pointer;
            width: 100%;
            font-weight: 700;
        }
      
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }
      
        /* 密码验证面板 */
        .password-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--white);
            color: #000;
            border-radius: 2.5vh;
            padding: 3.5vh;
            box-shadow: 0 0 4.5vh rgba(0,0,0,0.6);
            width: 85vw;
            max-width: 450px;
            z-index: 1001;
            text-align: center;
        }
      
        .password-panel h3 {
            font-size: 3vh;
            margin-bottom: 2.5vh;
            color: var(--primary-red);
            font-weight: 900;
        }
      
        .password-panel input {
            width: 100%;
            font-size: 2.5vh;
            padding: 2vh;
            margin-top: 0.8vh;
            border: 0.3vh solid var(--primary-red);
            border-radius: 1vh;
            text-align: center;
            letter-spacing: 0.8vh;
            font-weight: 600;
        }
      
        .password-panel button {
            margin-top: 2.5vh;
            font-size: 2.5vh;
            padding: 1.8vh;
            background-color: var(--primary-red);
            color: var(--white);
            border: none;
            border-radius: 1.2vh;
            cursor: pointer;
            width: 100%;
            font-weight: 700;
        }
      
        .password-error {
            color: #ff0000;
            font-size: 2vh;
            margin-top: 1.5vh;
            display: none;
            font-weight: 600;
        }
      
        /* 连接状态指示器 */
        .connection-status {
            position: fixed;
            top: 1vh;
            left: 1vh;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.8vh 1.5vh;
            border-radius: 0.8vh;
            font-size: 2vh;
            display: flex;
            align-items: center;
            z-index: 100;
            font-weight: 600;
        }
      
        .connection-dot {
            width: 1vh;
            height: 1vh;
            border-radius: 50%;
            margin-right: 0.8vh;
            background-color: #4CAF50;
            animation: pulse 2s infinite;
        }
      
        .connection-dot.disconnected {
            background-color: #f44336;
            animation: none;
        }
      
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
      
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(2vh); }
            to { opacity: 1; transform: translateY(0); }
        }
      
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
      
        /* 针对电视设备的全屏兼容性 */
        #fullscreenTrigger {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

<!-- 隐藏全屏触发器，用于电视兼容性 -->
<div id="fullscreenTrigger"></div>

<!-- 连接状态指示器 -->
<div class="connection-status">
    <div class="connection-dot" id="connectionDot"></div>
    <span id="connectionText">连接中...</span>
</div>

<!-- 控制面板 -->
<div class="controls">
    <button class="control-btn" id="rotateBtn">旋转(90°)</button>
    <button class="control-btn" id="fullscreenBtn">全屏</button>
    <button class="control-btn" id="adminBtn">设置</button>
</div>

<!-- 主内容容器 -->
<div class="container rotated-90"> <!-- 默认旋转90度适配竖屏电视 -->
  
    <!-- 顶部标题 -->
    <div class="header fade-in">
        <h1>老凤祥珠宝</h1>
        <div class="date" id="dateDisplay"></div>
    </div>
  
    <!-- 今日金价 -->
    <div class="gold-price-today fade-in">
        <span class="gold-price-label">今日金价：</span>
        <div class="gold-price-value" id="goldPrice">518</div>
    </div>
  
    <!-- 价格表格 -->
    <div class="price-table-container fade-in">
        <table class="price-table">
            <tr>
                <th>商品</th>
                <th>销售价<span class="price-unit">(元/克)</span></th>
                <th>回收价<span class="price-unit">(元/克)</span></th>
            </tr>
            <tr>
                <td>黄金</td>
                <td id="goldSell">518</td>
                <td id="goldBuy">488</td>
            </tr>
            <tr>
                <td>铂金990</td>
                <td class="hide-price">-</td>
                <td id="platinumBuy">265</td>
            </tr>
            <tr>
                <td>钯金990</td>
                <td class="hide-price">-</td>
                <td id="palladiumBuy">320</td>
            </tr>
            <tr>
                <td>白银</td>
                <td class="hide-price">-</td>
                <td id="silverBuy">6.5</td>
            </tr>
        </table>
    </div>
  
    <!-- 底部信息 -->
    <div class="update-time" id="updateTime">最后更新时间：加载中...</div>
    <div class="footer">有囍事，就有老凤祥</div>
</div>

<!-- 密码验证面板 -->
<div class="overlay" id="overlay"></div>
<div class="password-panel" id="passwordPanel">
    <h3>请输入密码验证身份</h3>
    <input type="password" id="passwordInput" placeholder="请输入密码" maxlength="20">
    <div class="password-error" id="passwordError">密码错误，请重新输入</div>
    <button id="submitPassword">确认</button>
    <button id="cancelPassword" style="margin-top: 1.5vh; background-color: #666;">取消</button>
</div>

<!-- 管理面板 -->
<div class="admin-panel" id="adminPanel">
    <h3>价格设置</h3>
    <label>黄金销售价(元/克)：</label>
    <input type="number" id="goldSellInput">
    <label>黄金回收价(元/克)：</label>
    <input type="number" id="goldBuyInput">
    <label>铂金990回收价(元/克)：</label>
    <input type="number" id="platinumBuyInput">
    <label>钯金990回收价(元/克)：</label>
    <input type="number" id="palladiumBuyInput">
    <label>白银回收价(元/克)：</label>
    <input type="number" id="silverBuyInput">
    <button id="savePrices">保存设置</button>
    <button id="closeAdmin" style="margin-top: 1.5vh; background-color: #666;">关闭</button>
</div>

<script>
    // Firebase配置
    const firebaseConfig = {
        apiKey: "AIzaSyCjBOSjFnZ9K1tzCQsIhYKQ8uCRG20I62Q",
        authDomain: "lfx-gold-display.firebaseapp.com",
        databaseURL: "https://lfx-gold-display-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "lfx-gold-display",
        storageBucket: "lfx-gold-display.firebasestorage.app",
        messagingSenderId: "76661746887",
        appId: "1:76661746887:web:914c61e18ddf8097cfa2e2"
    };

    // 初始化Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 全局变量
    let currentRotation = 90; // 默认旋转90度适配竖屏电视
    let isAdminMode = false;
    let controlsTimeout;
  
    // 设置默认密码
    const ADMIN_PASSWORD = "ai4869";
  
    // 页面加载完成后初始化
    window.addEventListener('DOMContentLoaded', (event) => {
        // 初始化Firebase连接
        initializeFirebase();
      
        // 初始化界面
        loadPrices();
        updateDate();
        updateRotationButton();
      
        // 自动进入全屏
        setTimeout(() => {
            toggleFullScreen();
        }, 1000);
      
        // 设置控制按钮事件
        document.getElementById('rotateBtn').addEventListener('click', rotateContent);
        document.getElementById('fullscreenBtn').addEventListener('click', toggleFullScreen);
        document.getElementById('adminBtn').addEventListener('click', showPasswordPanel);
        document.getElementById('savePrices').addEventListener('click', savePrices);
        document.getElementById('closeAdmin').addEventListener('click', cancelAdmin);
        document.getElementById('submitPassword').addEventListener('click', checkPassword);
        document.getElementById('cancelPassword').addEventListener('click', cancelPassword);
        document.getElementById('overlay').addEventListener('click', cancelPassword);
      
        // 密码输入框按下回车触发验证
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
      
        // 控制按钮自动隐藏逻辑
        document.addEventListener('mousemove', showControlsTemporarily);
        hideControls(); // 初始隐藏
    });
  
    // 初始化Firebase连接
    function initializeFirebase() {
        // 监听连接状态
        const connectedRef = firebase.database().ref(".info/connected");
        connectedRef.on("value", function(snap) {
            if (snap.val() === true) {
                document.getElementById("connectionDot").className = "connection-dot";
                document.getElementById("connectionText").textContent = "实时同步已连接";
                console.log("Firebase连接成功");
                setupFirebaseListeners();
            } else {
                document.getElementById("connectionDot").className = "connection-dot disconnected";
                document.getElementById("connectionText").textContent = "连接断开";
                console.warn("Firebase连接断开");
            }
        });
    }
  
    // 设置Firebase监听器
    function setupFirebaseListeners() {
        // 监听价格变化
        const pricesRef = database.ref('prices');
        pricesRef.on('value', (snapshot) => {
            const prices = snapshot.val();
            if (prices) {
                console.log('从Firebase接收价格更新:', prices);
                updatePrices(prices);
              
                // 更新本地存储
                Object.keys(prices).forEach(key => {
                    localStorage.setItem(key, prices[key]);
                });
            }
        });
    }
  
    // 保存价格到Firebase
    function savePricesToFirebase(prices) {
        database.ref('prices').set(prices)
            .then(() => {
                console.log('价格已保存到Firebase');
            })
            .catch((error) => {
                console.error('保存到Firebase失败:', error);
            });
    }
  
    // 旋转内容功能
    function rotateContent() {
        // 旋转角度选项：0°, 90°, 180°, 270°
        const rotations = [0, 90, 180, 270];
        const currentIndex = rotations.indexOf(currentRotation);
        const nextIndex = (currentIndex + 1) % rotations.length;
        currentRotation = rotations[nextIndex];
      
        // 更新容器类名
        const container = document.querySelector('.container');
        container.className = 'container';
      
        if (currentRotation !== 0) {
            container.classList.add(`rotated-${currentRotation}`);
        }
      
        updateRotationButton();
    }
  
    // 更新旋转按钮文本
    function updateRotationButton() {
        document.getElementById('rotateBtn').textContent = `旋转(${currentRotation}°)`;
    }
  
    // 全屏功能 - 强化兼容性
    function toggleFullScreen() {
        const element = document.documentElement;
      
        // 尝试各种全屏API
        if (!document.fullscreenElement && !document.webkitFullscreenElement && 
            !document.mozFullScreenElement && !document.msFullscreenElement) {
          
            if (element.requestFullscreen) {
                element.requestFullscreen().catch(err => {
                    console.error('全屏请求失败:', err);
                    showNotification('全屏模式不可用: ' + err.message);
                });
            } else if (element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.msRequestFullscreen) {
                element.msRequestFullscreen();
            } else {
                // 电视设备兼容方案
                showNotification('此设备不支持全屏模式');
            }
        } else {
            // 退出全屏
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }
  
    // 显示通知
    function showNotification(message) {
        // 临时显示一个简单的通知
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2vh;
            border-radius: 1vh;
            z-index: 10000;
            font-size: 2.5vh;
        `;
        document.body.appendChild(notification);
      
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 3000);
    }
  
    // 更新全屏按钮文本
    function updateFullscreenButton() {
        const btn = document.getElementById('fullscreenBtn');
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || 
                           document.mozFullScreenElement || document.msFullscreenElement;
        btn.textContent = isFullscreen ? '退出全屏' : '全屏';
    }
  
    // 监听全屏状态变化
    document.addEventListener('fullscreenchange', updateFullscreenButton);
    document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
    document.addEventListener('mozfullscreenchange', updateFullscreenButton);
    document.addEventListener('MSFullscreenChange', updateFullscreenButton);
  
    // 更新日期显示
    function updateDate() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        document.getElementById('dateDisplay').innerText = `${y}年${m}月${d}日`;
    }
  
    // 密码验证功能
    function showPasswordPanel() {
        document.getElementById('passwordPanel').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordError').style.display = 'none';
        document.getElementById('passwordInput').focus();
    }
  
    function hidePasswordPanel() {
        document.getElementById('passwordPanel').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }
  
    function checkPassword() {
        const password = document.getElementById('passwordInput').value;
        if (password === ADMIN_PASSWORD) {
            hidePasswordPanel();
            showAdminPanel();
        } else {
            document.getElementById('passwordError').style.display = 'block';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        }
    }
  
    function cancelPassword() {
        hidePasswordPanel();
    }
  
    // 管理面板功能
    function showAdminPanel() {
        const panel = document.getElementById('adminPanel');
        const keys = ['goldSell','goldBuy','platinumBuy','palladiumBuy','silverBuy'];
        keys.forEach(k => {
            document.getElementById(k+'Input').value = localStorage.getItem(k) || document.getElementById(k).innerText;
        });
        panel.style.display = 'block';
        isAdminMode = true;
        document.body.classList.add('show-controls');
    }
  
    function cancelAdmin() {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
        isAdminMode = false;
        hideControls();
    }
  
    // 控制按钮显示/隐藏功能
    function showControlsTemporarily() {
        if (isAdminMode) return;
      
        clearTimeout(controlsTimeout);
        document.body.classList.add('show-controls');
      
        controlsTimeout = setTimeout(() => {
            hideControls();
        }, 3000);
    }
  
    function hideControls() {
        document.body.classList.remove('show-controls');
    }
  
    // 价格管理功能
    function loadPrices() {
        const keys = ['goldSell','goldBuy','platinumBuy','palladiumBuy','silverBuy'];
        keys.forEach(k => {
            const value = localStorage.getItem(k);
            if (value) {
                document.getElementById(k).innerText = value;
            }
        });
        document.getElementById('goldPrice').innerText = localStorage.getItem('goldSell') || 518;
        updateTimeLabel();
    }
  
    function savePrices() {
        const keys = ['goldSell','goldBuy','platinumBuy','palladiumBuy','silverBuy'];
        const prices = {};
      
        keys.forEach(k => {
            const val = parseFloat(document.getElementById(k+'Input').value);
            if(!isNaN(val)) {
                localStorage.setItem(k, val);
                prices[k] = val;
            }
        });
      
        // 同步到Firebase
        savePricesToFirebase(prices);
      
        updatePrices();
        cancelAdmin();
    }
  
    function updatePrices(data = {}) {
        const keys = ['goldSell','goldBuy','platinumBuy','palladiumBuy','silverBuy'];
        keys.forEach(k => {
            const el = document.getElementById(k);
            if (el) {
                const val = data[k] || parseFloat(localStorage.getItem(k)) || parseFloat(el.innerText);
                el.innerText = val;
            }
        });
        document.getElementById('goldPrice').innerText = localStorage.getItem('goldSell') || data.goldSell || 518;
        updateTimeLabel();
    }
  
    function updateTimeLabel() {
        const now = new Date();
        document.getElementById('updateTime').innerText = "最后更新时间：" + now.toLocaleTimeString();
    }
</script>
</body>
</html>

